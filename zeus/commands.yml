# ________ ____  __ __  ______
#  \___   // __ \|  |  \/  ___/
#   /    /\  ___/|  |  /\___ \
#  /_____ \\___  >____//____  >
#        \/    \/           \/
#                    Build System
#                          v0.8.9
#

# default language
language: bash

globals:
  UBUNTU_IMAGE: dreadl0ck/trx-ubuntu
  ALPINE_IMAGE: dreadl0ck/trx-alpine
  VERSION: 1.0

# command data
commands:
  test:
    description: run unit tests
    exec: go test ./...

  release:
    description: release a new version
    exec: echo "TODO add goreleaser"

  build-trx-linux:
    description: compile for trx server for linux
    exec: |
      mkdir -p bin
      GOOS=linux go build -o bin/trx cmd/trx/*.go

  build-ubuntu-container:
    description: build and push ubuntu container

  build-alpine-container:
    dependencies:
      - build-trx-linux
    description: build and push alpine container

  run-local:
    description: run container locally
    exec: |
      cd docker
      docker build --no-cache -t ${IMAGE} .
      docker run -it -p 8081:8081 ${IMAGE}